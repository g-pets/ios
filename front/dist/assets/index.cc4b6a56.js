var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;let i,c;const u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,l=new WeakMap;let b={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return d.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return D(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),D(u.get(this))}:function(...t){return D(e.apply(g(this),t))}:function(t,...r){const n=e.call(g(this),t,...r);return p.set(n,t.sort?t.sort():[t]),D(n)}}function y(e){return"function"==typeof e?v(e):(e instanceof IDBTransaction&&function(e){if(d.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)}));d.set(e,t)}(e),t=e,(i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,b):e);var t}function D(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(D(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&u.set(t,e)})).catch((()=>{})),l.set(t,e),t}(e);if(f.has(e))return f.get(e);const t=y(e);return t!==e&&(f.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function m(e,t,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),i=D(a);return n&&a.addEventListener("upgradeneeded",(e=>{n(D(a.result),e.oldVersion,e.newVersion,D(a.transaction))})),r&&a.addEventListener("blocked",(()=>r())),i.then((e=>{s&&e.addEventListener("close",(()=>s())),o&&e.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),i}const I=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],E=new Map;function h(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(E.get(t))return E.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=B.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!I.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,o?"readwrite":"readonly");let a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),o&&s.done]))[0]};return E.set(t,s),s}b=(e=>{return i=((e,t)=>{for(var r in t||(t={}))o.call(t,r)&&a(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&a(e,r,t[r]);return e})({},e),t(i,r({get:(t,r,n)=>h(t,r)||e.get(t,r,n),has:(t,r)=>!!h(t,r)||e.has(t,r)}));var i})(b);export{m as o};
